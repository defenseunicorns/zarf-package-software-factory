# yaml-language-server: $schema=https://raw.githubusercontent.com/defenseunicorns/zarf/v0.26.1/zarf.schema.json
kind: ZarfPackageConfig
metadata:
  name: software-factory
  description: "Zarf deployment of a software factory"
  # Iron Bank doesn't support ARM
  architecture: amd64

components:
  - name: bigbang-dev-dns-modification
    required: true
    files:
      - source: ./files/modify-coredns.sh
        target: ./modify-coredns.sh
        executable: true
    actions:
      onDeploy:
        defaults:
          maxRetries: 0
        after:
          - cmd: ./modify-coredns.sh

  - name: setup
    required: true
    manifests:
      - name: setup-config
        files:
          - manifests/setup.yaml
    repos:
      - "###ZARF_PKG_VAR_DI2ME_REPO###"

  - name: postgres-operator
    required: true
    manifests:
      - name: postgres-operator-config
        files:
          - manifests/postgres-operator.yaml
    repos:
      - https://github.com/zalando/postgres-operator.git
    images:
      - registry1.dso.mil/ironbank/opensource/zalando/postgres-operator:v1.9.0
      - registry1.dso.mil/ironbank/opensource/zalando/logical-backup:v1.8.2
      - registry1.dso.mil/ironbank/opensource/zalando/pgbouncer:1.15.0
      - ghcr.io/zalando/spilo-15:2.1-p9

  - name: gitlab-redis
    required: true
    manifests:
      - name: gitlab-redis-config
        files:
          - manifests/gitlab-redis.yaml
    repos:
      - https://repo1.dso.mil/platform-one/big-bang/apps/application-utilities/redis.git
    images:
      - registry1.dso.mil/ironbank/bitnami/redis:7.0.10
      - docker.io/bitnami/redis-sentinel:7.0.10-debian-11-r2

  - name: big-bang
    required: true
    manifests:
      - name: big-bang-config
        files:
          - manifests/big-bang.yaml
    repos:
      - https://repo1.dso.mil/platform-one/big-bang/bigbang.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/core/istio-controlplane.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/core/istio-operator.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/core/jaeger.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/core/kiali.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/sandbox/kyverno.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/sandbox/kyverno-policies.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/sandbox/kyverno-reporter.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/core/elasticsearch-kibana.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/core/eck-operator.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/core/fluentbit.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/sandbox/promtail.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/sandbox/loki.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/core/monitoring.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/application-utilities/minio-operator.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/application-utilities/minio.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/developer-tools/gitlab.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/developer-tools/gitlab-runner.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/cluster-utilities/velero.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/sandbox/metrics-server.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/sandbox/neuvector.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/developer-tools/sonarqube.git

    # To get the list of all images used in Big Bang:
    #    - Download "package-images.yml" from the big bang release
    #    - Run `yq '.package-image-list.*.images' package-images.yml | yq 'unique'`
    # This will produce the entire unique list of images needed for the a full configuration of bigbang.
    # We configure a subset of images needed for this configuration of bigbang.
    # The full detailed list for the full configuration will be commented out below for reference.
    images:
      # The subset of unique images needed for this configuration of bigbang
      - "registry1.dso.mil/ironbank/big-bang/base:2.0.0"
      - "registry1.dso.mil/ironbank/opensource/istio/pilot:1.17.1"
      - "registry1.dso.mil/ironbank/opensource/istio/proxyv2:1.17.1"
      - "registry1.dso.mil/ironbank/opensource/istio/install-cni:1.17.1"
      - "registry1.dso.mil/ironbank/tetrate/istio/proxyv2:1.16.1-tetratefips-v1"
      - "registry1.dso.mil/ironbank/tetrate/istio/pilot:1.16.1-tetratefips-v1"
      - "registry1.dso.mil/ironbank/opensource/istio/operator:1.17.1"
      - "registry1.dso.mil/ironbank/tetrate/istio/operator:1.16.1-tetratefips-v1"
      - "registry1.dso.mil/ironbank/opensource/ingress-nginx/kube-webhook-certgen:v1.3.0"
      - "registry1.dso.mil/ironbank/opensource/jaegertracing/all-in-one:1.42.0"
      - "registry1.dso.mil/ironbank/opensource/jaegertracing/jaeger-operator:1.42.0"
      - "registry1.dso.mil/ironbank/opensource/kiali/kiali-operator:v1.65.0"
      - "registry1.dso.mil/ironbank/opensource/kiali/kiali:v1.65.0"
      - "registry1.dso.mil/ironbank/nirmata/kyverno:v1.8.5"
      - "registry1.dso.mil/ironbank/nirmata/kyvernopre:v1.8.5"
      - "registry1.dso.mil/ironbank/opensource/kubernetes/kubectl:v1.26.2"
      - "registry1.dso.mil/ironbank/nirmata/policy-reporter/policy-reporter:2.12.0"
      - "registry1.dso.mil/ironbank/elastic/elasticsearch/elasticsearch:8.6.0"
      - "registry1.dso.mil/ironbank/elastic/kibana/kibana:8.6.1"
      - "registry1.dso.mil/ironbank/opensource/bitnami/elasticsearch-exporter:1.5.0-debian-11-r17"
      - "registry1.dso.mil/ironbank/elastic/eck-operator/eck-operator:2.6.1"
      - "registry1.dso.mil/ironbank/opensource/fluent/fluent-bit:2.0.10"
      - "registry1.dso.mil/ironbank/opensource/grafana/promtail:v2.7.1"
      - "registry1.dso.mil/ironbank/opensource/grafana/loki:2.7.4"
      - "registry1.dso.mil/ironbank/big-bang/grafana/grafana-plugins:9.3.2"
      - "registry1.dso.mil/ironbank/kiwigrid/k8s-sidecar:1.21.0"
      - "registry1.dso.mil/ironbank/opensource/kubernetes/kube-state-metrics:v2.7.0"
      - "registry1.dso.mil/ironbank/opensource/prometheus-operator/prometheus-config-reloader:v0.61.1"
      - "registry1.dso.mil/ironbank/opensource/prometheus-operator/prometheus-operator:v0.61.1"
      - "registry1.dso.mil/ironbank/opensource/prometheus/alertmanager:v0.24.0"
      - "registry1.dso.mil/ironbank/opensource/prometheus/node-exporter:v1.5.0"
      - "registry1.dso.mil/ironbank/opensource/prometheus/prometheus:v2.40.5"
      - "registry1.dso.mil/ironbank/opensource/minio/operator:v4.5.8"
      - "registry1.dso.mil/ironbank/opensource/minio/console:v0.25.0"
      - "registry1.dso.mil/ironbank/opensource/minio/minio:RELEASE.2023-01-31T02-24-19Z"
      - "registry1.dso.mil/ironbank/bitnami/analytics/redis-exporter:v1.48.0"
      - "registry1.dso.mil/ironbank/bitnami/redis:7.0.0-debian-10-r3"
      - "registry1.dso.mil/ironbank/gitlab/gitlab/certificates:15.9.2"
      - "registry1.dso.mil/ironbank/gitlab/gitlab/cfssl-self-sign:1.6.1"
      - "registry1.dso.mil/ironbank/gitlab/gitlab/gitaly:15.9.2"
      - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-container-registry:15.9.2"
      - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-shell:15.9.2"
      - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-sidekiq:15.9.2"
      - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-toolbox:15.9.2"
      - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-webservice:15.9.2"
      - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-workhorse:15.9.2"
      - "registry1.dso.mil/ironbank/gitlab/gitlab/kubectl:15.9.2"
      - "registry1.dso.mil/ironbank/opensource/minio/mc:RELEASE.2022-12-24T15-21-38Z"
      - "registry1.dso.mil/ironbank/opensource/minio/minio:RELEASE.2022-12-12T19-27-27Z"
      - "registry1.dso.mil/ironbank/opensource/postgres/postgresql12:12.14"
      - "registry1.dso.mil/ironbank/redhat/ubi/ubi8:8.7"
      - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-exporter:15.9.2"
      - "registry1.dso.mil/ironbank/gitlab/gitlab-runner/gitlab-runner:v15.8.1"
      - "registry1.dso.mil/ironbank/gitlab/gitlab-runner/gitlab-runner-helper:v15.8.1"
      - "registry1.dso.mil/ironbank/opensource/kubernetes/kubectl:v1.26.3"
      - "registry1.dso.mil/ironbank/opensource/velero/velero-plugin-for-aws:v1.6.1"
      - "registry1.dso.mil/ironbank/opensource/velero/velero:v1.10.2"
      - "registry1.dso.mil/ironbank/opensource/velero/velero-plugin-for-csi:v0.4.2"
      - "registry1.dso.mil/ironbank/opensource/velero/velero-plugin-for-microsoft-azure:v1.6.1"
      - "registry1.dso.mil/ironbank/opensource/kubernetes-sigs/metrics-server:v0.6.2"
      - "registry1.dso.mil/ironbank/neuvector/neuvector/controller:5.1.1"
      - "registry1.dso.mil/ironbank/neuvector/neuvector/enforcer:5.1.1"
      - "registry1.dso.mil/ironbank/neuvector/neuvector/manager:5.1.1"
      - "registry1.dso.mil/ironbank/neuvector/neuvector/scanner:5"
      - "registry1.dso.mil/ironbank/neuvector/neuvector/prometheus-exporter:5.1.0"
      - "registry1.dso.mil/ironbank/big-bang/sonarqube-9:9.9.0-community"

      # The detailed list of images needed for all the packages in this version of bigbang.
      # Use this is reference when bringing in new packages to your bigbang configuration.
      # package-image-list:
      #   istio:
      #     version: "1.17.1-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/big-bang/base:2.0.0"
      #       - "registry1.dso.mil/ironbank/opensource/istio/pilot:1.17.1"
      #       - "registry1.dso.mil/ironbank/opensource/istio/proxyv2:1.17.1"
      #       - "registry1.dso.mil/ironbank/opensource/istio/install-cni:1.17.1"
      #       - "registry1.dso.mil/ironbank/tetrate/istio/proxyv2:1.16.1-tetratefips-v1"
      #       - "registry1.dso.mil/ironbank/tetrate/istio/pilot:1.16.1-tetratefips-v1"
      #       - "registry1.dso.mil/ironbank/big-bang/base:2.0.0"
      #   istiooperator:
      #     version: "1.17.1-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/istio/operator:1.17.1"
      #       - "registry1.dso.mil/ironbank/tetrate/istio/operator:1.16.1-tetratefips-v1"
      #   jaeger:
      #     version: "2.41.0-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/ingress-nginx/kube-webhook-certgen:v1.3.0"
      #       - "registry1.dso.mil/ironbank/opensource/jaegertracing/all-in-one:1.42.0"
      #       - "registry1.dso.mil/ironbank/opensource/jaegertracing/jaeger-operator:1.42.0"
      #       - "registry1.dso.mil/ironbank/big-bang/base:2.0.0"
      #   kiali:
      #     version: "1.65.0-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/kiali/kiali-operator:v1.65.0"
      #       - "registry1.dso.mil/ironbank/opensource/kiali/kiali:v1.65.0"
      #   clusterAuditor:
      #     version: "1.5.0-bb.2"
      #     images:
      #       - "registry1.dso.mil/ironbank/bigbang/cluster-auditor/opa-exporter:v0.0.7"
      #   gatekeeper:
      #     version: "3.11.0-bb.2"
      #     images:
      #       - "registry1.dso.mil/ironbank/big-bang/base:2.0.0"
      #       - "registry1.dso.mil/ironbank/opensource/kubernetes/kubectl:v1.26.2"
      #       - "registry1.dso.mil/ironbank/opensource/openpolicyagent/gatekeeper:v3.11.0"
      #   kyverno:
      #     version: "2.6.5-bb.3"
      #     images:
      #       - "registry1.dso.mil/ironbank/nirmata/kyverno:v1.8.5"
      #       - "registry1.dso.mil/ironbank/nirmata/kyvernopre:v1.8.5"
      #   kyvernopolicies:
      #     version: "1.1.0-bb.4"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/kubernetes/kubectl:v1.26.2"
      #   kyvernoreporter:
      #     version: "2.16.0-bb.1"
      #     images:
      #       - "registry1.dso.mil/ironbank/nirmata/policy-reporter/policy-reporter:2.12.0"
      #   logging:
      #     version: "1.1.0-bb.1"
      #     images:
      #       - "registry1.dso.mil/ironbank/elastic/elasticsearch/elasticsearch:8.6.0"
      #       - "registry1.dso.mil/ironbank/elastic/kibana/kibana:8.6.1"
      #       - "registry1.dso.mil/ironbank/big-bang/base:2.0.0"
      #       - "registry1.dso.mil/ironbank/opensource/bitnami/elasticsearch-exporter:1.5.0-debian-11-r17"
      #   eckoperator:
      #     version: "2.6.1-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/elastic/eck-operator/eck-operator:2.6.1"
      #   fluentbit:
      #     version: "0.25.0-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/fluent/fluent-bit:2.0.10"
      #   promtail:
      #     version: "6.8.1-bb.1"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/grafana/promtail:v2.7.1"
      #   loki:
      #     version: "4.8.0-bb.1"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/grafana/loki:2.7.4"
      #   neuvector:
      #     version: "2.4.2-bb.5"
      #     images:
      #       - "registry1.dso.mil/ironbank/neuvector/neuvector/controller:5.1.1"
      #       - "registry1.dso.mil/ironbank/neuvector/neuvector/enforcer:5.1.1"
      #       - "registry1.dso.mil/ironbank/neuvector/neuvector/manager:5.1.1"
      #       - "registry1.dso.mil/ironbank/neuvector/neuvector/scanner:5"
      #       - "registry1.dso.mil/ironbank/neuvector/neuvector/prometheus-exporter:5.1.0"
      #   tempo:
      #     version: "1.0.2-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/grafana/tempo-query:2.0.1"
      #       - "registry1.dso.mil/ironbank/opensource/grafana/tempo:2.0.1"
      #   monitoring:
      #     version: "43.1.2-bb.4"
      #     images:
      #       - "registry1.dso.mil/ironbank/big-bang/base:2.0.0"
      #       - "registry1.dso.mil/ironbank/big-bang/grafana/grafana-plugins:9.3.2"
      #       - "registry1.dso.mil/ironbank/kiwigrid/k8s-sidecar:1.21.0"
      #       - "registry1.dso.mil/ironbank/opensource/ingress-nginx/kube-webhook-certgen:v1.3.0"
      #       - "registry1.dso.mil/ironbank/opensource/kubernetes/kube-state-metrics:v2.7.0"
      #       - "registry1.dso.mil/ironbank/opensource/prometheus-operator/prometheus-config-reloader:v0.61.1"
      #       - "registry1.dso.mil/ironbank/opensource/prometheus-operator/prometheus-operator:v0.61.1"
      #       - "registry1.dso.mil/ironbank/opensource/prometheus/alertmanager:v0.24.0"
      #       - "registry1.dso.mil/ironbank/opensource/prometheus/node-exporter:v1.5.0"
      #       - "registry1.dso.mil/ironbank/opensource/prometheus/prometheus:v2.40.5"
      #   twistlock:
      #     version: "0.12.0-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/big-bang/base:2.0.0"
      #       - "registry1.dso.mil/ironbank/twistlock/console/console:22.12.415"
      #       - "registry1.dso.mil/ironbank/twistlock/defender/defender:22.12.415"
      #   argocd:
      #     version: "5.27.1-bb.1"
      #     images:
      #       - "registry1.dso.mil/ironbank/big-bang/argocd:v2.5.10"
      #       - "registry1.dso.mil/ironbank/big-bang/base:2.0.0"
      #       - "registry1.dso.mil/ironbank/bitnami/redis:7.0.0-debian-10-r3"
      #       - "registry1.dso.mil/ironbank/opensource/dexidp/dex:v2.36.0"
      #   authservice:
      #     version: "0.5.3-bb.5"
      #     images:
      #       - "registry1.dso.mil/ironbank/bitnami/redis:7.0.0-debian-10-r3"
      #       - "registry1.dso.mil/ironbank/istio-ecosystem/authservice:0.5.3"
      #   minioOperator:
      #     version: "4.5.8-bb.1"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/minio/operator:v4.5.8"
      #       - "registry1.dso.mil/ironbank/opensource/minio/console:v0.25.0"
      #   minio:
      #     version: "4.5.8-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/minio/minio:RELEASE.2023-01-31T02-24-19Z"
      #   gitlab:
      #     version: "6.9.2-bb.1"
      #     images:
      #       - "registry1.dso.mil/ironbank/bitnami/analytics/redis-exporter:v1.48.0"
      #       - "registry1.dso.mil/ironbank/bitnami/redis:7.0.0-debian-10-r3"
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab/certificates:15.9.2"
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab/cfssl-self-sign:1.6.1"
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab/gitaly:15.9.2"
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-container-registry:15.9.2"
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-shell:15.9.2"
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-sidekiq:15.9.2"
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-toolbox:15.9.2"
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-webservice:15.9.2"
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-workhorse:15.9.2"
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab/kubectl:15.9.2"
      #       - "registry1.dso.mil/ironbank/opensource/minio/mc:RELEASE.2022-12-24T15-21-38Z"
      #       - "registry1.dso.mil/ironbank/opensource/minio/minio:RELEASE.2022-12-12T19-27-27Z"
      #       - "registry1.dso.mil/ironbank/opensource/postgres/postgresql12:12.14"
      #       - "registry1.dso.mil/ironbank/redhat/ubi/ubi8:8.7"
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab/gitlab-exporter:15.9.2"
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab/kubectl:15.9.2"
      #   gitlabRunner:
      #     version: "0.49.1-bb.3"
      #     images:
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab-runner/gitlab-runner:v15.8.1"
      #       - "registry1.dso.mil/ironbank/gitlab/gitlab-runner/gitlab-runner-helper:v15.8.1"
      #       - "registry1.dso.mil/ironbank/redhat/ubi/ubi8:8.7"
      #   nexusRepositoryManager:
      #     version: "47.1.0-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/redhat/ubi/ubi8-minimal:8.7"
      #       - "registry1.dso.mil/ironbank/sonatype/nexus/nexus:3.47.1-01"
      #   sonarqube:
      #     version: "8.0.0-bb.1"
      #     images:
      #       - "registry1.dso.mil/ironbank/big-bang/base:2.0.0"
      #       - "registry1.dso.mil/ironbank/big-bang/sonarqube-9:9.9.0-community"
      #       - "registry1.dso.mil/ironbank/opensource/postgres/postgresql12:12.14"
      #   haproxy:
      #     version: "1.12.0-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/haproxy/haproxy22:v2.2.21"
      #   anchore:
      #     version: "1.23.0-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/anchore/engine/engine:1.1.0"
      #       - "registry1.dso.mil/ironbank/opensource/postgres/postgresql12:12.14"
      #       - "registry1.dso.mil/ironbank/anchore/enterprise/enterprise:4.5.0"
      #       - "registry1.dso.mil/ironbank/anchore/enterpriseui/enterpriseui:4.5.0"
      #   mattermostOperator:
      #     version: "1.20.0-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/mattermost/mattermost-operator:v1.20.0"
      #   mattermost:
      #     version: "7.8.1-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/mattermost/mattermost:7.8.1"
      #       - "registry1.dso.mil/ironbank/opensource/minio/mc:RELEASE.2022-08-23T05-45-20Z"
      #       - "registry1.dso.mil/ironbank/opensource/minio/minio:RELEASE.2022-11-26T22-43-32Z"
      #       - "registry1.dso.mil/ironbank/opensource/postgres/postgresql11:11.18-1"
      #       - "registry1.dso.mil/ironbank/opensource/postgres/postgresql12:12.14"
      #   velero:
      #     version: "3.1.5-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/kubernetes/kubectl:v1.26.3"
      #       - "registry1.dso.mil/ironbank/opensource/velero/velero-plugin-for-aws:v1.6.1"
      #       - "registry1.dso.mil/ironbank/opensource/velero/velero:v1.10.2"
      #       - "registry1.dso.mil/ironbank/opensource/velero/velero-plugin-for-csi:v0.4.2"
      #       - "registry1.dso.mil/ironbank/opensource/velero/velero-plugin-for-aws:v1.6.1"
      #       - "registry1.dso.mil/ironbank/opensource/velero/velero-plugin-for-microsoft-azure:v1.6.1"
      #   keycloak:
      #     version: "18.4.0-bb.2"
      #     images:
      #       - "registry1.dso.mil/ironbank/big-bang/base:2.0.0"
      #       - "registry1.dso.mil/ironbank/opensource/keycloak/keycloak:21.0.2"
      #       - "registry1.dso.mil/ironbank/opensource/postgres/postgresql12:12.14"
      #   vault:
      #     version: "0.23.0-bb.3"
      #     images:
      #       - "registry1.dso.mil/ironbank/big-bang/base:2.0.0"
      #       - "registry1.dso.mil/ironbank/hashicorp/vault/vault-k8s:1.1.0"
      #       - "registry1.dso.mil/ironbank/hashicorp/vault:1.12.4"
      #   metricsServer:
      #     version: "3.8.4-bb.0"
      #     images:
      #       - "registry1.dso.mil/ironbank/opensource/kubernetes-sigs/metrics-server:v0.6.2"

  - name: softwarefactoryaddons
    required: true
    manifests:
      - name: softwarefactoryaddons-config
        files:
          - manifests/softwarefactoryaddons.yaml
    repos:
      - https://repo1.dso.mil/platform-one/big-bang/apps/third-party/jira.git
      - https://repo1.dso.mil/platform-one/big-bang/apps/third-party/confluence.git
      - https://repo1.dso.mil/big-bang/product/community/jenkins.git
      - https://repo1.dso.mil/big-bang/apps/third-party/jfrog-platform.git
    images:
      # Jira
      - registry1.dso.mil/ironbank/atlassian/jira-data-center/jira-node:9.6.0
      - registry1.dso.mil/ironbank/redhat/ubi/ubi8-minimal:8.5
      # Confluence
      - registry1.dso.mil/ironbank/atlassian/confluence-data-center/confluence-node:7.18.1
      - registry1.dso.mil/ironbank/big-bang/base:2.0.0
      # Jenkins
      - registry1.dso.mil/ironbank/opensource/jenkins/jenkins:2.387.2-lts
      - registry1.dso.mil/ironbank/opensource/jenkins/inbound-agent:3107.v665000b_51092-4
      - registry1.dso.mil/ironbank/kiwigrid/k8s-sidecar:1.22.4
      # Artifactory
      - registry1.dso.mil/ironbank/jfrog/artifactory/artifactory:7.55.9
      - registry1.dso.mil/ironbank/opensource/postgres/postgresql:13.10
      - registry1.dso.mil/ironbank/redhat/ubi/ubi9-minimal:9.1.0
      # Currently unused, will need to be modified if any further
      # jfrog/artifactory services are enabled
      # - releases-docker.jfrog.io/alpine:3.13.5
      # - releases-docker.jfrog.io/bitnami/postgresql:13.2.0-debian-10-r55
      # - releases-docker.jfrog.io/bitnami/rabbitmq:3.8.14-debian-10-r32
      # - releases-docker.jfrog.io/bitnami/redis:6.2.1-debian-10-r9
      # - releases-docker.jfrog.io/jfrog/distribution-distribution:2.9.2
      # - releases-docker.jfrog.io/jfrog/elasticsearch-sg:7.13.2
      # - releases-docker.jfrog.io/jfrog/insight-scheduler:4.7.11
      # - releases-docker.jfrog.io/jfrog/insight-server:4.7.11
      # - releases-docker.jfrog.io/jfrog/mission-control:4.7.11
      # - releases-docker.jfrog.io/jfrog/nginx-artifactory-pro:7.24.3
      # - releases-docker.jfrog.io/jfrog/pipelines-api:1.17.6
      # - releases-docker.jfrog.io/jfrog/pipelines-installer:1.17.6
      # - releases-docker.jfrog.io/jfrog/pipelines-micro:1.17.6
      # - releases-docker.jfrog.io/jfrog/pipelines-router:1.17.6
      # - releases-docker.jfrog.io/jfrog/pipelines-vault-init:1.17.6
      # - releases-docker.jfrog.io/jfrog/pipelines-www:1.17.6
      # - releases-docker.jfrog.io/jfrog/router:7.24.1
      # - releases-docker.jfrog.io/jfrog/xray-analysis:3.31.1
      # - releases-docker.jfrog.io/jfrog/xray-indexer:3.31.1
      # - releases-docker.jfrog.io/jfrog/xray-persist:3.31.1
      # - releases-docker.jfrog.io/jfrog/xray-server:3.31.1
      # - releases-docker.jfrog.io/vault:1.3.4

  - name: optional-tools-linux-amd64
    required: false
    files:
      - source: https://github.com/fluxcd/flux2/releases/download/v0.31.1/flux_0.31.1_linux_amd64.tar.gz
        shasum: 640d2f9b403f446fbb7ee7b99bf58341aa1a98d64688b9f47e533b78dd212166
        target: flux.tar.gz
        executable: false
      - source: https://github.com/vmware-tanzu/velero/releases/download/v1.9.3/velero-v1.9.3-linux-amd64.tar.gz
        shasum: 13e498c1ebec1e7c5bd633cbd39775e2b60cc55c29333abf019abaf29f19cc0e
        target: velero.tar.gz
        executable: false
    actions:
      onDeploy:
        defaults:
          maxRetries: 0
        after:
          - cmd: tar -xzf flux.tar.gz -C /usr/sbin && chmod +x /usr/sbin/flux && rm flux.tar.gz
          # If GNU tar, need to add --wildcards flag. If BSD tar, adding --wildcards flag makes it barf. :grumpyface:
          - cmd: EXITCODE=$(tar --version | grep -q "gnu"); ADDL_FLAGS=$(if [ $? -eq 0 ]; then echo "--wildcards"; else echo ""; fi); tar -xzf velero.tar.gz -C /usr/sbin --strip-components=1 $ADDL_FLAGS 'velero-*-linux-amd64/velero' && chmod +x /usr/sbin/velero && rm velero.tar.gz
