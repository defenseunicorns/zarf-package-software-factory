# yaml-language-server: $schema=https://raw.githubusercontent.com/defenseunicorns/zarf/v0.21.3/zarf.schema.json
kind: ZarfPackageConfig
metadata:
  name: day-two-update

components:
  - name: setup
    required: true
    repos:
      - https://github.com/defenseunicorns/zarf-package-software-factory.git
    manifests:
      - name: setup-config
        files:
          - ../manifests/setup.yaml
  - name: postgres-operator
    required: true
    manifests:
      - name: postgres-operator-config
        files:
          - ../manifests/postgres-operator.yaml
  - name: gitlab-redis
    required: true
    manifests:
      - name: gitlab-redis-config
        files:
          - ../manifests/gitlab-redis.yaml
  - name: big-bang
    required: true
    manifests:
      - name: big-bang-config
        files:
          - ../manifests/big-bang.yaml
  - name: softwarefactoryaddons
    required: true
    manifests:
      - name: softwarefactoryaddons-config
        files:
          - ../manifests/softwarefactoryaddons.yaml
  - name: optional-tools-linux-amd64
    required: false
    files:
      - source: https://github.com/fluxcd/flux2/releases/download/v0.31.1/flux_0.31.1_linux_amd64.tar.gz
        shasum: 640d2f9b403f446fbb7ee7b99bf58341aa1a98d64688b9f47e533b78dd212166
        target: flux.tar.gz
        executable: false
      - source: https://github.com/vmware-tanzu/velero/releases/download/v1.9.3/velero-v1.9.3-linux-amd64.tar.gz
        shasum: 13e498c1ebec1e7c5bd633cbd39775e2b60cc55c29333abf019abaf29f19cc0e
        target: velero.tar.gz
        executable: false
    scripts:
      retry: false
      after:
        - "tar -xzf flux.tar.gz -C /usr/sbin && chmod +x /usr/sbin/flux && rm flux.tar.gz"
        - "tar -xzf velero.tar.gz -C /usr/sbin --strip-components=1 'velero-*-linux-amd64/velero' && chmod +x /usr/sbin/velero && rm velero.tar.gz"
